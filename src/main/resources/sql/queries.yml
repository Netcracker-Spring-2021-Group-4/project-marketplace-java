custom:
  postgres:
    user:
      get-by-email: >
        SELECT user_id, email, password, first_name, last_name, status_name, role_id
        FROM auth_user INNER JOIN user_status USING (status_id)
        WHERE email = ?;
      get-authorities: >
        SELECT role_name AS authority
        FROM user_role
        WHERE role_id = ?
        UNION ALL
        SELECT permission_name AS authority
        FROM permission INNER JOIN permission_role USING(permission_id)
        WHERE role_id = ?;
      create-new: >
        INSERT INTO auth_user (email, password, role_id, status_id, first_name, last_name) VALUES (?, ?, ?, ?, ?, ?);
      find-user-by-id: >
        SELECT email, password, first_name, last_name, status_name, role_id
        FROM auth_user INNER JOIN user_status USING (status_id)
        WHERE user_id = ?
      get-permissions: >
        SELECT permission_name
        FROM permission INNER JOIN permission_role USING(permission_id)
        WHERE role_id = ?;
      update-status: >
        UPDATE auth_user
        SET status_id=(SELECT status_id FROM user_status WHERE status_name=?)
        WHERE email=?;
      find-status-id-by-name: >
        SELECT status_id FROM user_status WHERE status_name=?;
    token:
      create-token: >
        INSERT INTO confirmation_token (token, user_email, expired_at) VALUES (?, ?, ?);
      read-token: >
        SELECT token, user_email, expired_at, is_activated FROM confirmation_token WHERE token=?
      activate-token: >
        UPDATE confirmation_token
        SET is_activated = true
        WHERE token = ?;
    auth:
      role:
        find-role-id-by-role-name: >
          SELECT role_id FROM user_role WHERE role_name=?;
